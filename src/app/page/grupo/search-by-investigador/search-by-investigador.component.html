<div class="search-container">
  <h2>Grupos de Investigaci√≥n</h2>

  <!-- Contenedor General de Filtros -->
  <div class="filters-area">
    <!-- Fila 1 de Filtros -->
    <div class="filters-row">
      <!-- Re-aplicar ng-select para Docente Investigador -->
      <div class="filter-item filter-item-large autocomplete-container">
        <label for="docente-ng-select">Docente Investigador</label>
        <ng-select 
            id="docente-ng-select"
            [items]="investigadorNames$ | async"
            [(ngModel)]="docenteInvestigador"
            [searchable]="true"
            [clearable]="true"
            placeholder="Seleccione o busque docente..."
            [loading]="isLoadingInvestigadores"
            (change)="onInvestigadorSelectChange()">
        </ng-select>
      </div>
      <!-- Fin filtro Docente con ng-select -->

      <!-- Reemplazar Autocompletado manual Grupo por ng-select -->
      <div class="filter-item autocomplete-container filter-item-medium">
        <label for="grupo-ng-select">Grupo de Investigacion</label>
        <ng-select 
            id="grupo-ng-select"
            [items]="grupoNames$ | async"
            [(ngModel)]="grupoInvestigacionFilter" 
            [searchable]="true"
            [clearable]="true"
            placeholder="Seleccione o busque grupo..."
            [loading]="isLoadingGrupos"
            (change)="onGrupoSelectChange()">
        </ng-select>
      </div>
      <!-- Fin filtro Grupo con ng-select -->

      <div class="filter-item filter-item-buttons">
        <button class="secondary-button" (click)="limpiarFiltros()">Limpiar</button>
      </div>
    </div>

    <!-- Fila 2 de Filtros -->
    <div class="filters-row">
      <!-- Reemplazar filtro manual L√≠nea por ng-select -->
      <div class="filter-item filter-item-large autocomplete-container">
        <label for="linea-ng-select">L√≠nea de Investigaci√≥n</label>
        <ng-select 
            id="linea-ng-select"
            [items]="lineaNames$ | async"
            [(ngModel)]="lineaInvestigacionFilter"
            [searchable]="true"
            [clearable]="true"
            placeholder="Seleccione o busque l√≠nea..."
            [loading]="isLoadingLineas"
            (change)="onLineaSelectChange()">
        </ng-select>
      </div>
      <!-- Fin filtro L√≠nea con ng-select -->

      <!-- Reemplazar filtro manual Tipo por ng-select -->
      <div class="filter-item filter-item-medium autocomplete-container">
        <label for="tipo-ng-select">Tipo de Investigaci√≥n</label>
        <ng-select 
            id="tipo-ng-select"
            [items]="tipoNames$ | async"
            [(ngModel)]="tipoInvestigacionFilter"
            [searchable]="true"
            [clearable]="true"
            placeholder="Seleccione o busque tipo..."
            [loading]="isLoadingTipos"
            (change)="onTipoSelectChange()">
        </ng-select>
      </div>
      <!-- Fin filtro Tipo con ng-select -->

      <!-- Reemplazar filtro manual A√±o por ng-select -->
      <div class="filter-item filter-item-small autocomplete-container">
        <label for="anio-ng-select">A√±o</label>
        <ng-select 
            id="anio-ng-select"
            [items]="anioNames$ | async"
            [(ngModel)]="anioFilter"
            [searchable]="true"
            [clearable]="true"
            placeholder="A√±o..."
            [loading]="isLoadingAnios"
            (change)="onAnioSelectChange()">
        </ng-select>
      </div>
      <!-- Fin filtro A√±o con ng-select -->

      <div class="filter-item filter-item-buttons">
        <button class="primary-button" (click)="verTodo()">Ver Todo</button>
      </div>
    </div>
  </div>

  <!-- Resultados y Paginaci√≥n -->
  <div class="results-section">
    <div *ngIf="isLoading" class="loading-results">
      <p>Buscando...</p>
      <!-- Spinner -->
    </div>

    <div *ngIf="!isLoading && searchPerformed && !apiResponse?.data?.length" class="no-results">
      <p>No se encontraron grupos para los criterios de b√∫squeda.</p>
    </div>

    <div *ngIf="!isLoading && apiResponse?.data?.length" class="results-content">
      <!-- Grid de Resultados -->
      <div class="results-grid">
        <div *ngFor="let item of apiResponse?.data" class="result-card">
          <div class="card-header">{{ item.grupo?.nombre }}</div>
          <div class="card-body">
            <p><strong>L√≠nea:</strong> {{ item.grupo?.lineaInvestigacion }}</p>
            <p><strong>Tipo:</strong> {{ item.grupo?.tipoInvestigacion }}</p>
            <ng-container *ngIf="item.investigadores && getCoordinador(item.investigadores) as coord">
              <p><strong>Coordinador:</strong>
                {{ coord?.nombre }}
                {{ coord?.apellido }}
              </p>
            </ng-container>
            <p *ngIf="!item.investigadores || !getCoordinador(item.investigadores)"><strong>Coordinador:</strong> No asignado</p>
            <p><strong>Integrantes:</strong></p>
            <ul *ngIf="item.investigadores && item.investigadores.length > 0">
              <li *ngFor="let integrante of getIntegrantes(item.investigadores)">
                {{ integrante?.nombre }} {{ integrante?.apellido }}
              </li>
            </ul>
            <p *ngIf="!item.investigadores || getIntegrantes(item.investigadores).length === 0">No hay integrantes registrados.</p>
          </div>
          <div class="card-footer">
            <div>
              <p><strong>N¬∫ Resoluci√≥n:</strong> {{ item.grupo?.numeroResolucion }}</p>
              <p><strong>Fecha:</strong> {{ item.grupo?.fechaRegistro | date:'dd '+'de '+'MMMM '+'de '+'yyyy' }}</p>
            </div>
            <div>
              <a [href]="getResolucionUrl(item.grupo?.archivo)" target="_blank" title="Ver Resoluci√≥n">
                Ver Resoluci√≥n <span class="eye-icon">üëÅÔ∏è</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Paginaci√≥n -->
      <div class="pagination-container" *ngIf="totalPages > 1">
        <span class="pagination-info">{{ itemsRange }}</span>
        <div class="pagination-controls">
          <button (click)="previousPage()" [disabled]="!canGoPrevious">&#9664;</button>
          <ng-container *ngFor="let page of paginationPages">
            <button *ngIf="page !== '...'" 
                    (click)="goToPage(+page)" 
                    [class.active]="page === currentPage">
              {{ page }}
            </button>
            <span *ngIf="page === '...'" class="pagination-dots">...</span>
          </ng-container>
          <button (click)="nextPage()" [disabled]="!canGoNext">&#9654;</button>
        </div>
      </div>
    </div>
  </div>
</div>
